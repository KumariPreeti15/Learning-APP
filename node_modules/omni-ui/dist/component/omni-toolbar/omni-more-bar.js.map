{
  "version": 3,
  "sources": ["../../../lib/component/omni-toolbar/omni-more-bar.ts"],
  "sourcesContent": ["//inspired by https://github.com/pinkhominid/more-bar\n\nexport class MoreBar {\n  barEl: HTMLSlotElement | HTMLElement;\n  moreEl: HTMLElement;\n  isJustifyEnd: boolean;\n  _itemObserver: IntersectionObserver;\n  _lastItemObserver: IntersectionObserver;\n\n  constructor(barEl, moreEl, isJustifyEnd = false) {\n    if (!barEl || !moreEl) throw new Error('MoreBar: two arguments required!');\n    this.barEl = barEl;\n    this.moreEl = moreEl;\n    this.isJustifyEnd = isJustifyEnd;\n  }\n\n  init() {\n    this.destroy();\n    this.barEl.style.display = 'flex';\n    this.moreEl.style.position = 'static';\n    const marginPlusWidth = this.#getWidthPlusMargins(this.moreEl);\n    this.#hideEl(this.moreEl);\n    this.barEl.style.minWidth = `${marginPlusWidth}px`;\n    const itemObserverOpts = {\n      root: this.barEl,\n      threshold: 0.99,\n      // setup margin placeholder for more item\n      rootMargin: this.isJustifyEnd ? `0px 0px 0px ${-marginPlusWidth}px` : `0px ${-marginPlusWidth}px 0px 0px`\n    };\n    const lastItemObserverOpts = {\n      ...itemObserverOpts,\n      rootMargin: '0px'\n    };\n    this._itemObserver = new IntersectionObserver(this.#onIntersection, itemObserverOpts);\n    this._lastItemObserver = new IntersectionObserver(this.#onIntersection, lastItemObserverOpts);\n    this.#observe();\n  }\n\n  public destroy() {\n    this.#unobserve();\n  }\n\n  #getWidthPlusMargins(el) {\n    const style = getComputedStyle(el);\n    const margins = {\n      top: parseInt(style.marginTop, 10),\n      right: parseInt(style.marginRight, 10),\n      left: parseInt(style.marginLeft, 10),\n      bottom: parseInt(style.marginBottom, 10)\n    };\n    return el.offsetWidth + margins.left + margins.right;\n  }\n\n  get #barItems() {\n    let barChildArry;\n    const bar = this.barEl as HTMLSlotElement;\n    if (bar.matches('slot')) {\n      barChildArry = bar.assignedElements();\n    } else {\n      barChildArry = Array.from(this.barEl.children);\n    }\n\n    const items = barChildArry.reduce((items, child) => {\n      if (child.matches('slot')) {\n        // use slotted elements\n        items = items.concat(child.assignedElements());\n      } else if (child !== this.moreEl) {\n        // otherwise use element (except more)\n        items.push(child);\n      }\n      return items;\n    }, []);\n\n    return this.isJustifyEnd ? items.reverse() : items;\n  }\n\n  get #firstHiddenItem() {\n    for (const item of this.#barItems) {\n      if (this.#isHidden(item)) return item;\n    }\n    return undefined;\n  }\n\n  #observe() {\n    const barItems = this.#barItems;\n    for (const item of barItems) {\n      if (item !== barItems[barItems.length - 1]) {\n        // not last item\n        this._itemObserver.observe(item);\n      } else {\n        this._lastItemObserver.observe(item);\n      }\n    }\n  }\n\n  #unobserve() {\n    this._itemObserver?.disconnect();\n    this._lastItemObserver?.disconnect();\n  }\n\n  #isHidden(el) {\n    return el?.style.visibility === 'hidden';\n  }\n\n  #hideEl(el) {\n    el.style.visibility = 'hidden';\n  }\n\n  #showEl(el) {\n    el.style.visibility = 'visible';\n  }\n\n  #positionMoreItem() {\n    this.#hideEl(this.moreEl);\n    this.moreEl.style.transform = '';\n    const firstHiddenItem = this.#firstHiddenItem;\n    if (firstHiddenItem) {\n      const side = this.isJustifyEnd ? 'right' : 'left';\n      this.moreEl.style.transform = `\n        translateX(${firstHiddenItem.getBoundingClientRect()[side] - this.moreEl.getBoundingClientRect()[side]}px)\n      `;\n      this.#showEl(this.moreEl);\n\n      this.barEl.dispatchEvent(\n        new CustomEvent('morebar-moreitem-show', {\n          bubbles: true,\n          detail: {\n            item: this.moreEl,\n            type: 'show',\n            transform: this.moreEl.style.transform,\n            moreBar: this\n          }\n        })\n      );\n    }\n  }\n\n  #onIntersection = entries => {\n    for (const entry of entries) {\n      let isShow;\n      if (entry.isIntersecting) {\n        this.#showEl(entry.target);\n        isShow = true;\n      } else {\n        this.#hideEl(entry.target);\n        isShow = false;\n      }\n\n      this.barEl.dispatchEvent(\n        new CustomEvent('morebar-item-update', {\n          bubbles: true,\n          detail: {\n            item: entry.target,\n            type: isShow ? 'show' : 'hide',\n            index: this.#barItems.indexOf(entry.target),\n            moreBar: this\n          }\n        })\n      );\n    }\n    this.#positionMoreItem();\n  };\n}\n"],
  "mappings": "AAEO,MAAM,QAAQ;AAAA,EAOnB,YAAY,OAAO,QAAQ,eAAe,OAAO;AAC/C,QAAI,CAAC,SAAS,CAAC,OAAQ,OAAM,IAAI,MAAM,kCAAkC;AACzE,SAAK,QAAQ;AACb,SAAK,SAAS;AACd,SAAK,eAAe;AAAA,EACtB;AAAA,EAEA,OAAO;AACL,SAAK,QAAQ;AACb,SAAK,MAAM,MAAM,UAAU;AAC3B,SAAK,OAAO,MAAM,WAAW;AAC7B,UAAM,kBAAkB,KAAK,qBAAqB,KAAK,MAAM;AAC7D,SAAK,QAAQ,KAAK,MAAM;AACxB,SAAK,MAAM,MAAM,WAAW,GAAG,eAAe;AAC9C,UAAM,mBAAmB;AAAA,MACvB,MAAM,KAAK;AAAA,MACX,WAAW;AAAA;AAAA,MAEX,YAAY,KAAK,eAAe,eAAe,CAAC,eAAe,OAAO,OAAO,CAAC,eAAe;AAAA,IAC/F;AACA,UAAM,uBAAuB;AAAA,MAC3B,GAAG;AAAA,MACH,YAAY;AAAA,IACd;AACA,SAAK,gBAAgB,IAAI,qBAAqB,KAAK,iBAAiB,gBAAgB;AACpF,SAAK,oBAAoB,IAAI,qBAAqB,KAAK,iBAAiB,oBAAoB;AAC5F,SAAK,SAAS;AAAA,EAChB;AAAA,EAEO,UAAU;AACf,SAAK,WAAW;AAAA,EAClB;AAAA,EAEA,qBAAqB,IAAI;AACvB,UAAM,QAAQ,iBAAiB,EAAE;AACjC,UAAM,UAAU;AAAA,MACd,KAAK,SAAS,MAAM,WAAW,EAAE;AAAA,MACjC,OAAO,SAAS,MAAM,aAAa,EAAE;AAAA,MACrC,MAAM,SAAS,MAAM,YAAY,EAAE;AAAA,MACnC,QAAQ,SAAS,MAAM,cAAc,EAAE;AAAA,IACzC;AACA,WAAO,GAAG,cAAc,QAAQ,OAAO,QAAQ;AAAA,EACjD;AAAA,EAEA,IAAI,YAAY;AACd,QAAI;AACJ,UAAM,MAAM,KAAK;AACjB,QAAI,IAAI,QAAQ,MAAM,GAAG;AACvB,qBAAe,IAAI,iBAAiB;AAAA,IACtC,OAAO;AACL,qBAAe,MAAM,KAAK,KAAK,MAAM,QAAQ;AAAA,IAC/C;AAEA,UAAM,QAAQ,aAAa,OAAO,CAACA,QAAO,UAAU;AAClD,UAAI,MAAM,QAAQ,MAAM,GAAG;AAEzB,QAAAA,SAAQA,OAAM,OAAO,MAAM,iBAAiB,CAAC;AAAA,MAC/C,WAAW,UAAU,KAAK,QAAQ;AAEhC,QAAAA,OAAM,KAAK,KAAK;AAAA,MAClB;AACA,aAAOA;AAAA,IACT,GAAG,CAAC,CAAC;AAEL,WAAO,KAAK,eAAe,MAAM,QAAQ,IAAI;AAAA,EAC/C;AAAA,EAEA,IAAI,mBAAmB;AACrB,eAAW,QAAQ,KAAK,WAAW;AACjC,UAAI,KAAK,UAAU,IAAI,EAAG,QAAO;AAAA,IACnC;AACA,WAAO;AAAA,EACT;AAAA,EAEA,WAAW;AACT,UAAM,WAAW,KAAK;AACtB,eAAW,QAAQ,UAAU;AAC3B,UAAI,SAAS,SAAS,SAAS,SAAS,CAAC,GAAG;AAE1C,aAAK,cAAc,QAAQ,IAAI;AAAA,MACjC,OAAO;AACL,aAAK,kBAAkB,QAAQ,IAAI;AAAA,MACrC;AAAA,IACF;AAAA,EACF;AAAA,EAEA,aAAa;AACX,SAAK,eAAe,WAAW;AAC/B,SAAK,mBAAmB,WAAW;AAAA,EACrC;AAAA,EAEA,UAAU,IAAI;AACZ,WAAO,IAAI,MAAM,eAAe;AAAA,EAClC;AAAA,EAEA,QAAQ,IAAI;AACV,OAAG,MAAM,aAAa;AAAA,EACxB;AAAA,EAEA,QAAQ,IAAI;AACV,OAAG,MAAM,aAAa;AAAA,EACxB;AAAA,EAEA,oBAAoB;AAClB,SAAK,QAAQ,KAAK,MAAM;AACxB,SAAK,OAAO,MAAM,YAAY;AAC9B,UAAM,kBAAkB,KAAK;AAC7B,QAAI,iBAAiB;AACnB,YAAM,OAAO,KAAK,eAAe,UAAU;AAC3C,WAAK,OAAO,MAAM,YAAY;AAAA,qBACf,gBAAgB,sBAAsB,EAAE,IAAI,IAAI,KAAK,OAAO,sBAAsB,EAAE,IAAI,CAAC;AAAA;AAExG,WAAK,QAAQ,KAAK,MAAM;AAExB,WAAK,MAAM;AAAA,QACT,IAAI,YAAY,yBAAyB;AAAA,UACvC,SAAS;AAAA,UACT,QAAQ;AAAA,YACN,MAAM,KAAK;AAAA,YACX,MAAM;AAAA,YACN,WAAW,KAAK,OAAO,MAAM;AAAA,YAC7B,SAAS;AAAA,UACX;AAAA,QACF,CAAC;AAAA,MACH;AAAA,IACF;AAAA,EACF;AAAA,EAEA,kBAAkB,aAAW;AAC3B,eAAW,SAAS,SAAS;AAC3B,UAAI;AACJ,UAAI,MAAM,gBAAgB;AACxB,aAAK,QAAQ,MAAM,MAAM;AACzB,iBAAS;AAAA,MACX,OAAO;AACL,aAAK,QAAQ,MAAM,MAAM;AACzB,iBAAS;AAAA,MACX;AAEA,WAAK,MAAM;AAAA,QACT,IAAI,YAAY,uBAAuB;AAAA,UACrC,SAAS;AAAA,UACT,QAAQ;AAAA,YACN,MAAM,MAAM;AAAA,YACZ,MAAM,SAAS,SAAS;AAAA,YACxB,OAAO,KAAK,UAAU,QAAQ,MAAM,MAAM;AAAA,YAC1C,SAAS;AAAA,UACX;AAAA,QACF,CAAC;AAAA,MACH;AAAA,IACF;AACA,SAAK,kBAAkB;AAAA,EACzB;AACF;",
  "names": ["items"]
}
